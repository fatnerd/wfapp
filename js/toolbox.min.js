function bubbleSort(a){var c,b;for(c=a.length-1;0<=c;c--)for(b=0;b<=c;b++)if(a[b+1]<a[b]){var d=a[b];a[b]=a[b+1];a[b+1]=d}return a}function bubbleSort2(a){var c,b;for(c=a.length-1;0<=c;c--)for(b=0;b<=c;b++)if(a[b+1].distance<a[b].distance){var d=a[b];a[b]=a[b+1];a[b+1]=d}return a}function Rad(a){return a*Math.PI/180}
function GetDistance(a,c,b,d){var a=Rad(a),b=Rad(b),e=a-b,c=Rad(c)-Rad(d),c=2*Math.asin(Math.sqrt(Math.pow(Math.sin(e/2),2)+Math.cos(a)*Math.cos(b)*Math.pow(Math.sin(c/2),2))),c=Math.round(63781370*c)/1E4;return 1E3*c}function distFiller(a,c,b,d){for(var e in b)b[e].distance=GetDistance(a,c,b[e].lat,b[e].lng);a=bubbleSort2(b);d(a)}
function Navitodetail(){var a=document.getElementById("detaillat").value,c=document.getElementById("detaillng").value,b=document.getElementById("detailname").innerHTML;useBMap?window.open("baidumap://map/marker?location="+a+","+c+"&title=\u76ee\u6807\u7ad9\u70b9&content="+b+"&coord_type=gcj02&src=jsw|wfibikeapp"):useAMap?window.open("iosamap://navi?sourceApplication=safari&backScheme=http&dlat="+a+"&dlon="+c+"&dname="+b+"&dev=0&t=4"):(alert("\u60a8\u6ca1\u6709\u8bbe\u7f6e\u5bfc\u822a\u5e94\u7528\uff01"),
alert("debug comment:\nType to URL to set AMap: javascript:useAMap=true; \n likely on BMap \n Need Application"))}function getLocation(a,c){navigator.geolocation?navigator.geolocation.getCurrentPosition(a,c):(console.log("Geolocation is not supported by this browser."),c())}$.ajaxSetup({cache:!0,async:!0});
function fillDetail(a){showload("detload");detnow=a;$.getScript(loc_interface+"?id="+a,function(){if("true"==sessionStorage["withGPS"]){var a=sessionStorage.GPSlat,b=sessionStorage.GPSlng;document.getElementById("detaildistance").innerHTML=GetDistance(a,b,isinglebike.station[0].lat,isinglebike.station[0].lng)}else document.getElementById("detaildistance").innerHTML="Unavailible";$.getJSON("http://api.map.baidu.com/ag/coord/convert?from=2&to=4&x="+isinglebike.station[0].lng+"&y="+isinglebike.station[0].lat+
"&callback=?",function(a){var b=window.atob(a.x),a=window.atob(a.y);document.getElementById("detailstatmap").src="http://api.map.baidu.com/staticimage?center="+b+","+a+"&markers="+b+","+a+"&width=270&height=216&zoom=17&dpitype=ph"});document.getElementById("detailid").innerHTML=isinglebike.station[0].id;document.getElementById("detailname").innerHTML=isinglebike.station[0].name;document.getElementById("detaillat").value=isinglebike.station[0].lat;document.getElementById("detaillng").value=isinglebike.station[0].lng;
document.getElementById("detailcapacity").innerHTML=isinglebike.station[0].capacity;document.getElementById("detailadd").innerHTML=isinglebike.station[0].address;document.getElementById("detailavail").innerHTML=isinglebike.station[0].availBike;a=isinglebike.station[0].capacity-isinglebike.station[0].availBike;document.getElementById("detailleft").innerHTML=a;document.getElementById("detailli1").removeAttribute("class");document.getElementById("detailli2").removeAttribute("class");3>=isinglebike.station[0].availBike?
document.getElementById("detailli1").setAttribute("data-theme","c"):6>=isinglebike.station[0].availBike&&3<isinglebike.station[0].availBike?document.getElementById("detailli1").setAttribute("data-theme","e"):document.getElementById("detailli1").setAttribute("data-theme","d");3>=a?document.getElementById("detailli2").setAttribute("data-theme","c"):6>=a&&3<a?document.getElementById("detailli2").setAttribute("data-theme","e"):document.getElementById("detailli2").setAttribute("data-theme","d");$("#detailnumlist").listview("refresh");
hideload("detload")})}function refreshDetail(){fillDetail(detnow)}function fillList(){$("#mainload").text("\u4ece\u670d\u52a1\u5668\u4e0a\u62c9\u53d6\u6570\u636e......");document.getElementById("searchform").reset();$.getScript(loc_interface,function(){"true"==sessionStorage["withGPS"]?distFiller(sessionStorage.GPSlat,sessionStorage.GPSlng,ibike.station,fillListwPos):fillListwoPos()})}
function fillListwPos(a){$("#mainload").text("\u6b63\u5728\u5448\u73b0\u5230\u5217\u8868\u4e0a......");setTimeout(function(){var c=document.createDocumentFragment(),b;for(b in a){var d=document.createElement("li"),e=document.createElement("a");e.setAttribute("href","#detail");e.id="stat"+(a[b].id-1);e.setAttribute("distance",a[b].distance);e.setAttribute("ontouchstart","fillDetail("+a[b].id+");");e.setAttribute("arrayid",a[b].id-1);e.innerHTML=a[b].id+". "+a[b].name+"&nbsp;&nbsp;&nbsp;&nbsp;\u5269 "+
a[b].availBike+" / "+(a[b].capacity-a[b].availBike)+" \u7a7a";d.appendChild(e);c.appendChild(d)}document.getElementById("mainlist").innerHTML="";document.getElementById("mainlist").appendChild(c);$("#mainlist").listview("refresh");hideload("mainload")},5)}
function fillListwoPos(){$("#mainload").text("\u6b63\u5728\u5448\u73b0\u5230\u5217\u8868\u4e0a......");setTimeout(function(){var a=document.createDocumentFragment(),c;for(c in ibike.station){var b=document.createElement("li"),d=document.createElement("a");d.setAttribute("href","#detail");d.id="stat"+(ibike.station[c].id-1);d.setAttribute("ontouchstart","fillDetail("+ibike.station[c].id+");");d.setAttribute("arrayid",ibike.station[c].id-1);d.innerHTML=ibike.station[c].id+". "+ibike.station[c].name+
"&nbsp;&nbsp;&nbsp;&nbsp;\u5269 "+ibike.station[c].availBike+" / "+(ibike.station[c].capacity-ibike.station[c].availBike)+" \u7a7a";b.appendChild(d);a.appendChild(b)}document.getElementById("mainlist").innerHTML="";document.getElementById("mainlist").appendChild(a);$("#mainlist").listview("refresh");hideload("mainload")},5)};